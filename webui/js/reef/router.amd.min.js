/*! Reef v7.3.0 | (c) 2020 Chris Ferdinandi | MIT License | http://github.com/cferdinandi/reef */
define((function(){"use strict";var e=/([:*])(\w+)/g,t=/\*/g,r="([^/]+)",n="(?:.*)",o="(?:/$|$)",i="",a=!!window.history&&!!window.history.pushState,u=function(e){return"/"+e.replace(/^\/|\/$/g,"")},c=function(a,c){if(!c||"array"!==Reef._.trueTypeOf(c))return[];if("/"===a){var s=function(e){var t=e.filter((function(e){return"/"===e.url}));if(t.length)return[{route:t[0],params:{}}]}(c);if(s)return s}return c.map((function(c){var s=function(a){var u=[];return{regexp:new RegExp(a.replace(e,(function(e,t,n){return u.push(n),r})).replace(t,n)+o,i),paramNames:u}}(u(c.url)),f=a.replace(/^\/+/,"/").match(s.regexp);if(f)return{route:c,params:function(e,t){return e&&0!==t.length?e.slice(1,e.length).reduce((function(e,r,n){return e[t[n]]=decodeURIComponent(r),e}),{}):{}}(f,s.paramNames)}})).filter((function(e){return e}))},s=function(e,t){t&&(window.location.hash="!/"+u(t)+e);var r=document.getElementById(e.slice(1));r&&(r.scrollIntoView(),document.activeElement!==r&&(r.setAttribute("tabindex","-1"),r.focus()))},f=function(e,t,r,n){var o=function(e,t,r){(r&&".html"===e.pathname.slice(-5)||0===e.hash.indexOf("#!"))&&(e=m(e.hash.slice(2),t));var n=u(e.pathname);return t.length?(t=u(t),0===n.indexOf(t)&&(n=n.slice(t.length)),n):n}(e,r,n),i=c(o,t);if(i.length){var a=Reef.clone(i[0].route);return a.params=i[0].params,a.search=function(e){var t={},r=e.search.substring(1).split("&");if(r.length<1||r[0].length<1)return t;for(var n=0;n<r.length;n++){var o=r[n].split("=");t[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return t}(e),a}},h=function(e,t){Reef.emit(window,"beforeRouteUpdated",{current:e,next:t})},l=function(e,t){Reef.emit(window,"routeUpdated",{current:e,previous:t})},d=function(e,t){if(e&&e.title){var r="function"==typeof t.title?t.title(e):t.title;document.title=r.replace("{{title}}",e.title)}},p=function(e,t,r){var n;t._components.forEach((function(e){"render"in e&&e.render()})),d(e,t),r?s(r):(n=document.querySelector("h1, h2, h3, h4, h5, h6"))&&(n.hasAttribute("tabindex")||n.setAttribute("tabindex","-1"),n.focus())},v=function(e,t){var r=f(e,t.routes,t.root,t.hash);if(r.redirect)return v(m("function"==typeof r.redirect?r.redirect(r):r.redirect,t.root),t);if(t.hash&&(t.hashing=!0,r.url===t.current.url&&e.hash.length))s(e.hash,r.url);else{var n=t.current;h(n,r),t.current=r;var o=u(e.getAttribute("href"));t.hash?window.location.hash="!"+o:history.pushState(r||{},r&&r.title?r.title:"",o),p(r,t,e.hash),l(r,n)}},m=function(e,t){var r=document.createElement("a");return r.href=(t.length?u(t):"")+u(e),r},w=function(e,t){if(!(e.metaKey||e.ctrlKey||e.shiftKey||e.defaultPrevented)){var r,n=function(e){var t=e.target;if("closest"in t)return t.closest("a");var r=e.path||(e.composedPath?e.composedPath():null);if(r)for(var n=0;n<r.length;n++)if(r[n].nodeName&&"a"===r[n].nodeName.toLowerCase()&&r[n].href)return r[n]}(e);if(!(!n||n.host!==window.location.host||n.hasAttribute("download")||"external"===n.getAttribute("rel")||n.href.indexOf("mailto:")>-1))if((r=n).pathname!==window.location.pathname||r.search!==window.location.search||t.hash||!n.hash.length)e.preventDefault(),v(n,t)}};Reef.Router=function(e){if(!e||!e.routes||"array"!==Reef._.trueTypeOf(e.routes)||!e.routes.length)return Reef._.err("Please provide an array of routes.");var t=this,r=e.routes,n=e.root?e.root:"",o=e.title?e.title:"{{title}}",i=[],u=e.useHash||!a||"file:"===window.location.protocol,c=f(window.location,r,n,u);t._hashing=!1;Object.defineProperties(t,{routes:{value:Reef.clone(r,!0)},root:{value:n},title:{value:o},hash:{value:u}}),Object.defineProperty(t,"current",{get:function(){return Reef.clone(c,!0)},set:function(e){return c=e,!0}}),Object.defineProperty(t,"_routes",{set:function(e){return r=e,!0}}),Object.defineProperty(t,"_components",{get:function(){return i}}),d(c,t),document.addEventListener("click",(function(e){w(e,t)})),u?window.addEventListener("hashchange",(function(e){!function(e,t){if(t.hashing)t.hashing=!1;else{var r=m(window.location.hash.slice(2),t.root),n=(r.getAttribute("href"),f(r,t.routes,t.root,t.hash)),o=t.current;h(o,n),t.current=n,p(n,t),l(n,o)}}(0,t)})):(history.replaceState(c,document.title,window.location.href),window.addEventListener("popstate",(function(e){!function(e,t){if(e.state){var r=t.current;h(r,e.state),t.current=e.state,p(t.current,t),l(e.state,r)}else history.replaceState(t.current,document.title,window.location.href)}(e,t)})))},Reef.Router.prototype.addRoutes=function(e){var t=Reef._.trueTypeOf(e);if(["array","object"].indexOf(t)<0)return Reef._.err("Please provide a valid route or routes.");var r=this.routes;"object"===t?r.push(e):r.concat(e),this._routes=r},Reef.Router.prototype.addComponent=function(e){this._components.push(e)},Reef.Router.prototype.navigate=function(e){v(m(e,this.root),this)}}));
